#!/bin/bash

# Проверяем, были ли переданы аргументы
if [ "$#" -eq 0 ]; then
    zenity --error --text="Пожалуйста, укажите файлы или папки для архивации."
    exit 1
fi

# Запрос имени архива
archive_name=$(zenity --entry --title="Имя архива" --entry-text=$1 --text="Введите имя для архива (без расширения):")

# Если имя не введено, выходим
if [ -z "$archive_name" ]; then
    zenity --error --text="Имя архива не может быть пустым."
    exit 1
fi

# Запрос степени сжатия
compression_level=$(zenity --list --title="Степень сжатия" --text="Выберите степень сжатия:" \
    --column="Степень" "0 (без сжатия)" "1 (быстрое)" "3 (среднее)" "5 (нормальное)" "7 (максимальное)" "9 (ультра)")

# Преобразование выбранного уровня в числовое значение
case "$compression_level" in
    "0 (без сжатия)") level=0 ;;
    "1 (быстрое)") level=1 ;;
    "3 (среднее)") level=3 ;;
    "5 (нормальное)") level=5 ;;
    "7 (максимальное)") level=7 ;;
    "9 (ультра)") level=9 ;;
    *) zenity --error --text="Неверный выбор степени сжатия."; exit 1 ;;
esac

# Запрос размера тома
volume_size=$(zenity --entry --title="Размер тома" --entry-text="999M" --text="Введите размер тома в мегабайтах (например, 100M для 100 МБ):")

# Проверка корректности ввода размера тома
if [[ ! "$volume_size" =~ ^[0-9]+[KMG]?$ ]]; then
    zenity --error --text="Неверный формат размера тома. Используйте форматы типа 100M, 1G и т.д."
    exit 1
fi

# Создание архива с указанными параметрами
7z a -v"$volume_size" -mx="$level" "${archive_name}.7z" "$@"

# Проверка статуса выполнения команды
if [ $? -eq 0 ]; then
    zenity --info --text="Архив успешно создан: ${archive_name}.7z"
else
    zenity --error --text="Ошибка при создании архива."
fi

